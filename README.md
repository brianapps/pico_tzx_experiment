# Pico OTLA loader

This project is a very rough and ready experiment that allows TZX files generated by fast loader programs (e.g. OTLA and K7ZX) to be loaded onto a real ZX Spectrum using a RPi Pico.

The code uses the RP2040 programmable IO to send pulses to GPIO 3 whose durations are precise multiple of Z80 t-states.

To use it simply wire a 3.5mm mono jack so that the tip of the jack is connected to GPIO 3 and the sleeve of the jack is connected to GND on the Pico.

The code achieves this by:
* Underclocking the PICO to 122.5MHz. This is 35 times faster than a Z80. `vcocalc.py` was used to check that this frequency. It is possible to this achieve precisely if a non-default REFDIV value is used, this has been added to the CMakeLists.txt file.
* Setting the clock divider on the PIO SM to be 5 -- meaning 7 PIO instructions execute in 1 t-state.
* Adding delays to the PIO program so that the output pin is toggled and held for the number of t-states given by values received from TX FIFO.


The pico code waits for 2 seconds after powering on and plays complete TZX. The code simply loops and feeds the sm fifo with pulses widths that are derived from a TZX file. The pico code is basically a hack of the blink_pio example from the SDK. I haven't even bothered to change the file names.


The pulse widths are stored in `pulses.c` and this file is generated by the `pulses.py` Python script. This script uses the [tzxtool](https://github.com/shred/tzxtools/) libary to load a TZX file and extract the pulse widths from it. The script takes a single parameter that is the path of the TZX file. e.g.

```
python pulses.py tzx/atic_k7zx.tzx
```

Three tzx are included in the `tzx` directory:
* `atic_k7zx.tzx` an example tzx file generated from k7zx
* `atic_otla.tzx` an example tzx file generated by otla
* `atic_zqloader.tzx` an example tzx file generated by [zqloader](https://github.com/oxidaan/zqloader). This file uses generalized data blocks and playback of this block type is not currently supported by tzxtools.
